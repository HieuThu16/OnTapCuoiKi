    MÃ” HÃŒNH PHÃ‚N Lá»šP 3 Lá»šP (THREE-TIER ARCHITECTURE)
MÃ´ hÃ¬nh 3 lá»›p lÃ  kiáº¿n trÃºc pháº§n má»m phá»• biáº¿n giÃºp tá»• chá»©c mÃ£ nguá»“n rÃµ rÃ ng, dá»… báº£o trÃ¬ vÃ  má»Ÿ rá»™ng. Gá»“m 3 táº§ng chÃ­nh:
1. Presentation Layer (Táº§ng trÃ¬nh bÃ y / Giao diá»‡n ngÆ°á»i dÃ¹ng)
Hay cÃ²n gá»i lÃ : UI (User Interface) / Front-End / View

âœ”ï¸ Chá»©c nÄƒng chÃ­nh:
Hiá»ƒn thá»‹ dá»¯ liá»‡u cho ngÆ°á»i dÃ¹ng

Thu tháº­p dá»¯ liá»‡u tá»« ngÆ°á»i dÃ¹ng (qua form, input,...)

Gá»­i yÃªu cáº§u (request) Ä‘áº¿n táº§ng xá»­ lÃ½ (Business Layer)

Nháº­n vÃ  xá»­ lÃ½ sá»± kiá»‡n giao diá»‡n (event: click, submit,...)
2. Business Logic Layer (Táº§ng xá»­ lÃ½ nghiá»‡p vá»¥ / Business Layer - BL)
CÃ²n gá»i lÃ : Middle Tier / Domain Layer / Logic Layer

âœ”ï¸ Chá»©c nÄƒng chÃ­nh:
Xá»­ lÃ½ logic nghiá»‡p vá»¥ cá»§a á»©ng dá»¥ng

Xá»­ lÃ½ tÃ­nh toÃ¡n, kiá»ƒm tra Ä‘iá»u kiá»‡n, rÃ ng buá»™c,...

Nháº­n dá»¯ liá»‡u tá»« UI vÃ  gá»­i xuá»‘ng táº§ng Data Access

LÃ  nÆ¡i tÃ¡ch biá»‡t pháº§n xá»­ lÃ½ logic khá»i giao diá»‡n
3. Data Access Layer (Táº§ng truy xuáº¥t dá»¯ liá»‡u / DAL)
CÃ²n gá»i lÃ : Data Layer / Persistence Layer

âœ”ï¸ Chá»©c nÄƒng chÃ­nh:
Giao tiáº¿p vá»›i há»‡ quáº£n trá»‹ cÆ¡ sá»Ÿ dá»¯ liá»‡u (MySQL, SQL Server,...)

Thá»±c hiá»‡n truy váº¥n (SQL), lÆ°u trá»¯, Ä‘á»c, cáº­p nháº­t vÃ  xÃ³a dá»¯ liá»‡u

TÃ¡ch biá»‡t viá»‡c truy xuáº¥t dá»¯ liá»‡u khá»i logic xá»­ lÃ½
ğŸ’¡ VÃ­ dá»¥ Ä‘Æ¡n giáº£n (thÃªm khÃ¡ch hÃ ng)
Presentation Layer:
btnSave.addActionListener(e -> customerBL.AddCustomer(customer));
Business Layer:
public class CustomerBL {
    public void AddCustomer(Customer c) {
        customerDAL.insertCustomer(c);
    }
}
Data Access Layer:
public class CustomerDAL {
    public void insertCustomer(Customer c) {
        String sql = "INSERT INTO Customer VALUES (?, ?)";
        // sá»­ dá»¥ng JdbcTemplate hoáº·c Connection Ä‘á»ƒ thá»±c thi
    }
}

DÆ°á»›i Ä‘Ã¢y lÃ  toÃ n bá»™ **lÃ½ thuyáº¿t mÃ´ hÃ¬nh MVC (Model â€“ View â€“ Controller)** má»™t cÃ¡ch rÃµ rÃ ng, dá»… hiá»ƒu, cÃ³ **in Ä‘áº­m** nhá»¯ng pháº§n **trá»ng tÃ¢m dá»… ra tráº¯c nghiá»‡m**, kÃ¨m vÃ­ dá»¥ minh há»a:

---

# ğŸ§  **MÃ” HÃŒNH MVC LÃ€ GÃŒ?**

**MVC (Model â€“ View â€“ Controller)** lÃ  má»™t mÃ´ hÃ¬nh thiáº¿t káº¿ pháº§n má»m **chia chÆ°Æ¡ng trÃ¬nh thÃ nh 3 pháº§n riÃªng biá»‡t** Ä‘á»ƒ quáº£n lÃ½ code tá»‘t hÆ¡n, dá»… báº£o trÃ¬ vÃ  má»Ÿ rá»™ng.

---

# âœ… **CÃC THÃ€NH PHáº¦N TRONG MVC**
## 1. **Model â€“ MÃ´ hÃ¬nh dá»¯ liá»‡u**
### âœ”ï¸ Nhiá»‡m vá»¥:
* **Quáº£n lÃ½ dá»¯ liá»‡u vÃ  logic nghiá»‡p vá»¥**
* Káº¿t ná»‘i vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u (CSDL)
* Thá»±c hiá»‡n cÃ¡c thao tÃ¡c CRUD (Create, Read, Update, Delete)

### ğŸ§  Tráº¯c nghiá»‡m dá»… ra:
* **â€œThÃ nh pháº§n nÃ o chá»‹u trÃ¡ch nhiá»‡m xá»­ lÃ½ dá»¯ liá»‡u?â€ â†’ Model**
--
## 2. **View â€“ Giao diá»‡n ngÆ°á»i dÃ¹ng**
### âœ”ï¸ Nhiá»‡m vá»¥:
* **Hiá»ƒn thá»‹ dá»¯ liá»‡u cho ngÆ°á»i dÃ¹ng**
* **Thu tháº­p dá»¯ liá»‡u nháº­p vÃ o (qua form, button, input,...)**
* **Nháº­n sá»± kiá»‡n tá»« ngÆ°á»i dÃ¹ng** (click, nháº­p liá»‡u,...)
### ğŸ§  Tráº¯c nghiá»‡m dá»… ra:
* **â€œLá»›p View cÃ³ chá»©c nÄƒng gÃ¬?â€ â†’ Hiá»ƒn thá»‹ dá»¯ liá»‡u vÃ  nháº­n sá»± kiá»‡n**
* **â€œTáº§ng nÃ o nháº­n sá»± kiá»‡n trong mÃ´ hÃ¬nh MVC?â€ â†’ View**
---
## 3. **Controller â€“ Bá»™ Ä‘iá»u khiá»ƒn**
### âœ”ï¸ Nhiá»‡m vá»¥:
* **Nháº­n yÃªu cáº§u tá»« View**
* **Gá»i cÃ¡c phÆ°Æ¡ng thá»©c trong Model Ä‘á»ƒ xá»­ lÃ½**
* **Tráº£ dá»¯ liá»‡u vá» cho View**


# ğŸ” **QUY TRÃŒNH HOáº T Äá»˜NG MVC**
1. **NgÆ°á»i dÃ¹ng thao tÃ¡c vá»›i View** (vÃ­ dá»¥: click â€œÄÄƒng nháº­pâ€)
2. **View gá»­i yÃªu cáº§u Ä‘áº¿n Controller**
3. **Controller xá»­ lÃ½ yÃªu cáº§u vÃ  gá»i Model Ä‘á»ƒ thao tÃ¡c dá»¯ liá»‡u**
4. **Model tráº£ káº¿t quáº£ vá» Controller**
5. **Controller gá»­i dá»¯ liá»‡u tá»›i View Ä‘á»ƒ hiá»ƒn thá»‹**

# ğŸ“Œ **So sÃ¡nh MVC vÃ  mÃ´ hÃ¬nh 3 lá»›p**

| Äáº·c Ä‘iá»ƒm             | MVC                       | 3-Layer Architecture      |
| -------------------- | ------------------------- | ------------------------- |
| Má»¥c tiÃªu chÃ­nh       | Tá»• chá»©c giao diá»‡n & logic | Tá»• chá»©c toÃ n bá»™ kiáº¿n trÃºc |
| Táº§ng giao diá»‡n       | View                      | Presentation Layer        |
| Táº§ng xá»­ lÃ½ nghiá»‡p vá»¥ | Controller                | Business Logic Layer      |
| Táº§ng dá»¯ liá»‡u         | Model                     | Data Access Layer         |

DÆ°á»›i Ä‘Ã¢y lÃ  toÃ n bá»™ kiáº¿n thá»©c tá»•ng há»£p vá» **ORM (Object-Relational Mapping)** â€“ ráº¥t há»¯u Ã­ch cho kiá»ƒm tra, thá»±c hÃ nh vÃ  lÃ m Ä‘á»“ Ã¡n. MÃ¬nh sáº½ **in Ä‘áº­m cÃ¡c Ã½ dá»… ra tráº¯c nghiá»‡m** vÃ  cung cáº¥p vÃ­ dá»¥ báº±ng Java (Hibernate) Ä‘á»ƒ báº¡n hiá»ƒu rÃµ hÆ¡n.

---

# ğŸ§  ORM lÃ  gÃ¬?

**ORM (Object-Relational Mapping)** lÃ  má»™t **ká»¹ thuáº­t láº­p trÃ¬nh** giÃºp **chuyá»ƒn Ä‘á»•i dá»¯ liá»‡u giá»¯a há»‡ quáº£n trá»‹ cÆ¡ sá»Ÿ dá»¯ liá»‡u quan há»‡ (RDBMS)** (nhÆ° MySQL, PostgreSQL...) vÃ  **cÃ¡c Ä‘á»‘i tÆ°á»£ng trong ngÃ´n ngá»¯ láº­p trÃ¬nh hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng** (nhÆ° Java, C#...).

ğŸ‘‰ **Má»¥c tiÃªu chÃ­nh:**
GiÃºp láº­p trÃ¬nh viÃªn **lÃ m viá»‡c vá»›i database thÃ´ng qua Ä‘á»‘i tÆ°á»£ng**, **khÃ´ng cáº§n viáº¿t cÃ¢u lá»‡nh SQL thuáº§n**.

---

# âœ… Æ¯u Ä‘iá»ƒm cá»§a ORM

* **Giáº£m code SQL thá»§ cÃ´ng** â†’ dá»… viáº¿t code hÆ¡n
* **Dá»… báº£o trÃ¬, dá»… má»Ÿ rá»™ng**
* **Tá»± Ä‘á»™ng Ã¡nh xáº¡ (mapping) giá»¯a báº£ng vÃ  class**
* **Há»— trá»£ cÃ¡c má»‘i quan há»‡: One-to-One, One-to-Many, Many-to-Many**
* **Há»— trá»£ transaction, lazy loading, caching,...**

---

# âš ï¸ NhÆ°á»£c Ä‘iá»ƒm cá»§a ORM

* KhÃ´ng linh hoáº¡t báº±ng viáº¿t SQL thuáº§n
* Xá»­ lÃ½ kÃ©m vá»›i truy váº¥n phá»©c táº¡p, Ä‘áº·c biá»‡t lÃ  JOIN nhiá»u báº£ng
* **Hiá»‡u suáº¥t Ä‘Ã´i khi kÃ©m hÆ¡n dÃ¹ng JDBC trá»±c tiáº¿p**

---

# ğŸ”° CÃ¡c thÆ° viá»‡n ORM phá»• biáº¿n

| NgÃ´n ngá»¯ | ORM                                      |
| -------- | ---------------------------------------- |
| Java     | **Hibernate**, JPA (Jakarta Persistence) |
| C#       | Entity Framework                         |
| Python   | SQLAlchemy, Django ORM                   |
| PHP      | Doctrine ORM, Eloquent (Laravel)         |

---

# ğŸ“¦ CÃ¡ch hoáº¡t Ä‘á»™ng cá»§a ORM

### VÃ­ dá»¥:

Giáº£ sá»­ cÃ³ báº£ng `users` trong MySQL:

```sql
CREATE TABLE users (
  id INT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(50),
  email VARCHAR(100)
);
```
ORM sáº½ Ã¡nh xáº¡ thÃ nh class Java nhÆ° sau:
```java
@Entity
@Table(name = "users")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private int id;

    private String name;
    private String email;

    // getters, setters
}
---
# ğŸ“Œ CÃ¡c annotation quan trá»ng trong ORM (Hibernate / JPA)

| Annotation                                             | Ã nghÄ©a                                      |
| ------------------------------------------------------ | -------------------------------------------- |
| `@Entity`                                              | ÄÃ¡nh dáº¥u class lÃ  1 thá»±c thá»ƒ Ã¡nh xáº¡ vá»›i báº£ng |
| `@Table(name = "...")`                                 | Chá»‰ Ä‘á»‹nh tÃªn báº£ng tÆ°Æ¡ng á»©ng                  |
| `@Id`                                                  | Chá»‰ Ä‘á»‹nh khÃ³a chÃ­nh                          |
| `@GeneratedValue`                                      | Tá»± Ä‘á»™ng tÄƒng giÃ¡ trá»‹ id                      |
| `@Column(name = "...")`                                | Ãnh xáº¡ tÃªn cá»™t náº¿u khÃ¡c tÃªn biáº¿n             |
| `@OneToMany`, `@ManyToOne`, `@ManyToMany`, `@OneToOne` | Ãnh xáº¡ cÃ¡c má»‘i quan há»‡ giá»¯a cÃ¡c entity       |

---

# ğŸ”„ CÃ¡c loáº¡i quan há»‡ trong ORM

## 1. **One-to-One**

VÃ­ dá»¥: Má»—i `User` cÃ³ má»™t `Profile`.

```java
@OneToOne
@JoinColumn(name = "profile_id")
private Profile profile;
```

## 2. **One-to-Many**

VÃ­ dá»¥: Má»™t `User` cÃ³ nhiá»u `Post`.

```java
@OneToMany(mappedBy = "user")
private List<Post> posts;
```

## 3. **Many-to-One**

VÃ­ dá»¥: Nhiá»u `Post` thuá»™c vá» 1 `User`.

```java
@ManyToOne
@JoinColumn(name = "user_id")
private User user;
```

## 4. **Many-to-Many**

VÃ­ dá»¥: Nhiá»u `Student` há»c nhiá»u `Course`.

```java
@ManyToMany
@JoinTable(
  name = "student_course",
  joinColumns = @JoinColumn(name = "student_id"),
  inverseJoinColumns = @JoinColumn(name = "course_id")
)
private Set<Course> courses;
```

---

# ğŸ”§ ORM vs JDBC (truy váº¥n thuáº§n)

| TiÃªu chÃ­       | ORM                              | JDBC truyá»n thá»‘ng         |
| -------------- | -------------------------------- | ------------------------- |
| TÃ­nh dá»… dÃ¹ng   | **Cao (code Ã­t, dá»… hiá»ƒu)**       | Pháº£i viáº¿t SQL thá»§ cÃ´ng    |
| Mapping        | Tá»± Ä‘á»™ng Ã¡nh xáº¡ vá»›i class         | Pháº£i Ã¡nh xáº¡ thá»§ cÃ´ng      |
| TÃ­nh má»Ÿ rá»™ng   | Cao                              | Trung bÃ¬nh                |
| Hiá»‡u nÄƒng      | CÃ³ thá»ƒ kÃ©m náº¿u truy váº¥n phá»©c táº¡p | Nhanh náº¿u viáº¿t SQL tá»‘i Æ°u |
| TÃ­nh kiá»ƒm soÃ¡t | KÃ©m hÆ¡n JDBC                     | Kiá»ƒm soÃ¡t toÃ n bá»™         |

---

# ğŸ“ CÃ¢u há»i tráº¯c nghiá»‡m máº«u

1. ORM lÃ  gÃ¬?
   â†’ **Ká»¹ thuáº­t Ã¡nh xáº¡ giá»¯a Ä‘á»‘i tÆ°á»£ng vÃ  báº£ng dá»¯ liá»‡u**

2. Annotation nÃ o dÃ¹ng Ä‘á»ƒ Ä‘Ã¡nh dáº¥u khÃ³a chÃ­nh?
   â†’ `@Id`

3. Má»‘i quan há»‡ giá»¯a lá»›p `Student` vÃ  `Course` (nhiá»u - nhiá»u) dÃ¹ng annotation nÃ o?
   â†’ **@ManyToMany**

4. ORM há»— trá»£ Ä‘iá»u gÃ¬ sau Ä‘Ã¢y?

   * a. Lazy Loading
   * b. Mapping báº£ng sang class
   * c. Transaction
   * d. Táº¥t cáº£ cÃ¡c Ä‘Ã¡p Ã¡n trÃªn
     â†’ **ÄÃ¡p Ã¡n Ä‘Ãºng: d**

5. ORM phÃ¹ há»£p nháº¥t khi nÃ o?
   â†’ **Dá»± Ã¡n vá»«a hoáº·c lá»›n, muá»‘n dá»… báº£o trÃ¬ vÃ  Ã­t viáº¿t SQL**
DÆ°á»›i Ä‘Ã¢y lÃ  má»™t vÃ­ dá»¥ **Ä‘áº§y Ä‘á»§ CRUD báº±ng Hibernate vá»›i Spring Boot**, sá»­ dá»¥ng `User` entity (bao gá»“m cÃ¡c thao tÃ¡c Create, Read, Update, Delete).

 
```
â””â”€â”€ src/main/java/com/example/demo/
    â”œâ”€â”€ entity/User.java
    â”œâ”€â”€ repository/UserRepository.java
    â”œâ”€â”€ service/UserService.java
    â”œâ”€â”€ controller/UserController.java
    â””â”€â”€ DemoApplication.java
```
---
## 1. `User` Entity (DÃ¹ng JPA - Hibernate)
package com.example.demo.entity;
import jakarta.persistence.*;
@Entity
@Table(name = "users")
public class User {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;
    private String email;

    // Constructors
    public User() {}

    public User(String name, String email) {
        this.name = name;
        this.email = email;
    }

    // Getters & Setters
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }

    public String getName() { return name; }
    public void setName(String name) { this.name = name; }

    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }
}


## 2. `UserRepository` (DÃ¹ng `JpaRepository`)
package com.example.demo.repository;
import com.example.demo.entity.User;
import org.springframework.data.jpa.repository.JpaRepository;

public interface UserRepository extends JpaRepository<User, Long> {
}


## 3. `UserService` (Chá»©a logic nghiá»‡p vá»¥)

@Service
public class UserService {

    @Autowired
    private UserRepository userRepository;

    public User createUser(User user) {
        return userRepository.save(user);
    }

    public List<User> getAllUsers() {
        return userRepository.findAll();
    }

    public Optional<User> getUserById(Long id) {
        return userRepository.findById(id);
    }

    public User updateUser(Long id, User userDetails) {
        User user = userRepository.findById(id).orElseThrow();
        user.setName(userDetails.getName());
        user.setEmail(userDetails.getEmail());
        return userRepository.save(user);
    }

    public void deleteUser(Long id) {
        userRepository.deleteById(id);
    }
}

@RestController
@RequestMapping("/api/users")
public class UserController {

    @Autowired
    private UserService userService;

    @PostMapping
    public User createUser(@RequestBody User user) {
        return userService.createUser(user);
    }

    @GetMapping
    public List<User> getAllUsers() {
        return userService.getAllUsers();
    }

    @GetMapping("/{id}")
    public User getUserById(@PathVariable Long id) {
        return userService.getUserById(id).orElse(null);
    }

    @PutMapping("/{id}")
    public User updateUser(@PathVariable Long id, @RequestBody User userDetails) {
        return userService.updateUser(id, userDetails);
    }

    @DeleteMapping("/{id}")
    public void deleteUser(@PathVariable Long id) {
        userService.deleteUser(id);
    }
}

DÆ°á»›i Ä‘Ã¢y lÃ  toÃ n bá»™ kiáº¿n thá»©c cÆ¡ báº£n **cáº§n nhá»› vá» Hibernate** â€“ má»™t pháº§n ráº¥t **quan trá»ng trong láº­p trÃ¬nh Java vÃ  ORM**, thÆ°á»ng Ä‘Æ°á»£c há»i trong kiá»ƒm tra vÃ  thá»±c hÃ nh.

## ğŸ”° 1. Hibernate lÃ 
**Hibernate** lÃ  má»™t **framework ORM mÃ£ nguá»“n má»Ÿ** cho Java, dÃ¹ng Ä‘á»ƒ **Ã¡nh xáº¡ cÃ¡c Ä‘á»‘i tÆ°á»£ng Java (class) vá»›i báº£ng trong cÆ¡ sá»Ÿ dá»¯ liá»‡u quan há»‡ (RDBMS)**.
ğŸ‘‰ NÃ³ giÃºp **quáº£n lÃ½ cÆ¡ sá»Ÿ dá»¯ liá»‡u báº±ng láº­p trÃ¬nh hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng**, thay vÃ¬ pháº£i viáº¿t SQL thá»§ cÃ´ng.
---
## âœ… 2. Æ¯u Ä‘iá»ƒm cá»§a Hibernate
* **Tá»± Ä‘á»™ng Ã¡nh xáº¡ (mapping)** giá»¯a class vÃ  table
* **KhÃ´ng cáº§n viáº¿t nhiá»u SQL** â†’ dá»… báº£o trÃ¬, gá»n gÃ ng
* Há»— trá»£ **transaction**, **lazy loading**, **caching**,â€¦
* **Äá»™c láº­p CSDL** (MySQL, PostgreSQL, Oracle, H2,â€¦)
* Quáº£n lÃ½ má»‘i quan há»‡ **One-to-One, One-to-Many, Many-to-Many**
---
## âš™ï¸ 3. CÃ¡ch hoáº¡t Ä‘á»™ng cá»§a Hibernate
1. **Hibernate Configuration**: Äá»c file `hibernate.cfg.xml` hoáº·c cáº¥u hÃ¬nh Spring Boot Ä‘á»ƒ káº¿t ná»‘i database.
2. **SessionFactory**: Táº¡o ra cÃ¡c `Session`.
3. **Session**: DÃ¹ng Ä‘á»ƒ thao tÃ¡c vá»›i DB (thÃªm, sá»­a, xÃ³a, truy váº¥n).
4. **Transaction**: Äáº£m báº£o an toÃ n dá»¯ liá»‡u (ACID).
---
## ğŸ“Œ 4. CÃ¡c thÃ nh pháº§n chÃ­nh cá»§a Hibernate
| ThÃ nh pháº§n         | Chá»©c nÄƒng                                               |
| ------------------ | ------------------------------------------------------- |
| **Configuration**  | Cáº¥u hÃ¬nh Hibernate (database, dialect, driver, entityâ€¦) |
| **SessionFactory** | Factory táº¡o `Session`                                   |
| **Session**        | LÃ m viá»‡c vá»›i database                                   |
| **Transaction**    | Quáº£n lÃ½ giao dá»‹ch                                       |
| **Query** / HQL    | Truy váº¥n dá»¯ liá»‡u                                        |

---

## ğŸ§¾ 5. Annotation quan trá»ng trong Hibernate

| Annotation          | Ã nghÄ©a                                |
| ------------------- | -------------------------------------- |
| `@Entity`           | ÄÃ¡nh dáº¥u class lÃ  thá»±c thá»ƒ Ã¡nh xáº¡ báº£ng |
| `@Table(name = "")` | TÃªn báº£ng                               |
| `@Id`               | KhÃ³a chÃ­nh                             |
| `@GeneratedValue`   | Tá»± Ä‘á»™ng tÄƒng                           |
| `@Column`           | Ãnh xáº¡ cá»™t                             |
| `@OneToMany`        | Má»™t-nhiá»u                              |
| `@ManyToOne`        | Nhiá»u-má»™t                              |
| `@ManyToMany`       | Nhiá»u-nhiá»u                            |
| `@JoinColumn`       | Cá»™t khÃ³a ngoáº¡i                         |

---

## ğŸ§ª 6. Hibernate Query Language (HQL)

Giá»‘ng SQL nhÆ°ng dÃ¹ng tÃªn class vÃ  field thay vÃ¬ tÃªn báº£ng.

**VÃ­ dá»¥:**
Session session = sessionFactory.openSession();
Query query = session.createQuery("FROM User WHERE name = :name");
query.setParameter("name", "Nam");
List<User> users = query.list();
```
--

## ğŸ”„ 7. CÃ¡c hÃ m CRUD phá»• biáº¿n

| PhÆ°Æ¡ng thá»©c Hibernate | MÃ´ táº£       |
| --------------------- | ----------- |
| `save()`              | ThÃªm má»›i    |
| `get()` / `find()`    | TÃ¬m theo ID |
| `update()`            | Cáº­p nháº­t    |
| `delete()`            | XÃ³a báº£n ghi |

---

## ğŸ“ 8. File cáº¥u hÃ¬nh `hibernate.cfg.xml` (náº¿u khÃ´ng dÃ¹ng Spring Boot)
```xml
<hibernate-configuration>
  <session-factory>
    <property name="hibernate.connection.driver_class">com.mysql.cj.jdbc.Driver</property>
    <property name="hibernate.connection.url">jdbc:mysql://localhost:3306/your_db</property>
    <property name="hibernate.connection.username">root</property>
    <property name="hibernate.connection.password">password</property>

    <property name="hibernate.dialect">org.hibernate.dialect.MySQLDialect</property>
    <property name="show_sql">true</property>
    <property name="hbm2ddl.auto">update</property>

    <mapping class="com.example.User"/>
  </session-factory>
</hibernate-configuration>
```


## ğŸ’¡ 9. Má»™t sá»‘ cáº¥u hÃ¬nh quan trá»ng trong Hibernate

| Thuá»™c tÃ­nh               | Ã nghÄ©a                                                          |
| ------------------------ | ---------------------------------------------------------------- |
| `hibernate.dialect`      | Biáº¿t cÃ¡ch viáº¿t SQL phÃ¹ há»£p vá»›i loáº¡i CSDL                         |
| `hibernate.hbm2ddl.auto` | `update`, `create`, `validate`, `none` â€“ cÃ¡ch Hibernate táº¡o báº£ng |
| `show_sql`               | In SQL ra console                                                |


DÆ°á»›i Ä‘Ã¢y lÃ  **toÃ n bá»™ kiáº¿n thá»©c vÃ  vÃ­ dá»¥ chi tiáº¿t** vá» **One-to-Many** vÃ  **Many-to-One** trong Hibernate (dÃ¹ng vá»›i Spring Boot). ÄÃ¢y lÃ  pháº§n **cá»±c ká»³ quan trá»ng**, thÆ°á»ng xuáº¥t hiá»‡n trong thi lÃ½ thuyáº¿t láº«n khi lÃ m Ä‘á»“ Ã¡n thá»±c táº¿.

---
## ğŸ” 1. One-to-Many vÃ  Many-to-One lÃ  gÃ¬?
### âœ… One-to-Many
* **Má»™t Ä‘á»‘i tÆ°á»£ng cha** cÃ³ thá»ƒ liÃªn káº¿t vá»›i **nhiá»u Ä‘á»‘i tÆ°á»£ng con**.
* VÃ­ dá»¥: **Má»™t User cÃ³ nhiá»u Post.**

### âœ… Many-to-One

* **Nhiá»u Ä‘á»‘i tÆ°á»£ng con** liÃªn káº¿t Ä‘áº¿n **má»™t Ä‘á»‘i tÆ°á»£ng cha**.
* VÃ­ dá»¥: **Nhiá»u Post thuá»™c vá» má»™t User.**

âš ï¸ Hai má»‘i quan há»‡ nÃ y luÃ´n Ä‘i kÃ¨m: **Má»™t bÃªn lÃ  `@OneToMany`, bÃªn kia lÃ  `@ManyToOne`**.

---

## ğŸ“¦ 2. Cáº¥u trÃºc báº£ng trong vÃ­ dá»¥

Giáº£ sá»­ báº¡n cÃ³ 2 báº£ng:
* `users` (User)
* `posts` (Post, cÃ³ khÃ³a ngoáº¡i `user_id` trá» Ä‘áº¿n User)
---
## ğŸ§± 3. Entity: User vÃ  Post
### ğŸ”¹ `User.java` (One-to-Many side)
```java
@Entity
@Table(name = "users")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;

    // Má»™t User cÃ³ nhiá»u Post
    @OneToMany(mappedBy = "user", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<Post> posts = new ArrayList<>();

    // getters, setters
}
```

### ğŸ”¹ `Post.java` (Many-to-One side)

```java
@Entity
@Table(name = "posts")
public class Post {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String content;

    // Nhiá»u Post thuá»™c vá» má»™t User
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "user_id")
    private User user;

    // getters, setters
}
```

---

## ğŸ” 4. CÃ¡ch sá»­ dá»¥ng (thÃªm dá»¯ liá»‡u)

```java
User user = new User();
user.setName("Nguyá»…n VÄƒn A");

Post post1 = new Post();
post1.setContent("BÃ i viáº¿t 1");
post1.setUser(user); // thiáº¿t láº­p chá»§ nhÃ¢n bÃ i viáº¿t

Post post2 = new Post();
post2.setContent("BÃ i viáº¿t 2");
post2.setUser(user);
user.getPosts().add(post1);
user.getPosts().add(post2);

userRepository.save(user); // Tá»± Ä‘á»™ng lÆ°u cáº£ 2 bÃ i viáº¿t nhá» cascade
```
---

## ğŸ’¡ 5. ChÃº thÃ­ch cÃ¡c Annotation chÃ­nh
| Annotation                      | Ã nghÄ©a                                                  |
| ------------------------------- | -------------------------------------------------------- |
| `@OneToMany(mappedBy = "user")` | Quan há»‡ má»™t-nhiá»u. `mappedBy` pháº£i lÃ  tÃªn field bÃªn Post |
| `cascade = CascadeType.ALL`     | Tá»± Ä‘á»™ng lÆ°u cáº£ quan há»‡ con                               |
| `orphanRemoval = true`          | XÃ³a con khi bá»‹ remove khá»i danh sÃ¡ch                     |
| `@ManyToOne`                    | Quan há»‡ nhiá»u-má»™t                                        |
| `@JoinColumn(name = "user_id")` | KhÃ³a ngoáº¡i                                               |

## ğŸ§  6. CÃ¢u há»i tráº¯c nghiá»‡m thÆ°á»ng gáº·p
1. **Annotation nÃ o dÃ¹ng Ä‘á»ƒ biá»ƒu diá»…n má»‘i quan há»‡ One-to-Many trong Hibernate?**
   â†’ `@OneToMany`
2. **Trong `@OneToMany`, thuá»™c tÃ­nh `mappedBy` dÃ¹ng Ä‘á»ƒ lÃ m gÃ¬?**
   â†’ XÃ¡c Ä‘á»‹nh tÃªn biáº¿n bÃªn phÃ­a chá»§ sá»Ÿ há»¯u cá»§a quan há»‡ (phÃ­a Many).
3. **CascadeType.ALL dÃ¹ng Ä‘á»ƒ lÃ m gÃ¬?**
   â†’ Tá»± Ä‘á»™ng truyá»n thao tÃ¡c save/update/delete Ä‘áº¿n cÃ¡c entity liÃªn quan.
4. **Trong quan há»‡ nhiá»u-má»™t, cá»™t khÃ³a ngoáº¡i Ä‘Æ°á»£c Ã¡nh xáº¡ báº±ng annotation nÃ o?**
   â†’ `@JoinColumn`
5. **Náº¿u muá»‘n tá»± Ä‘á»™ng xÃ³a cÃ¡c pháº§n tá»­ con khi bá»‹ remove khá»i danh sÃ¡ch, dÃ¹ng?**
   â†’ `orphanRemoval = true`

## ğŸ§ª 7. LÆ°u Ã½ khi triá»ƒn khai

* Äáº·t `@OneToMany(mappedBy = "user")` á»Ÿ phÃ­a khÃ´ng giá»¯ khÃ³a ngoáº¡i.
* PhÃ­a giá»¯ khÃ³a ngoáº¡i (á»Ÿ Ä‘Ã¢y lÃ  `Post`) sáº½ cÃ³ `@ManyToOne` vÃ  `@JoinColumn`.
* NÃªn dÃ¹ng `CascadeType.ALL` náº¿u muá»‘n thao tÃ¡c Ä‘á»“ng thá»i.
* TrÃ¡nh **láº·p vÃ´ háº¡n** khi `toString()` do gá»i qua láº¡i giá»¯a hai class â†’ dÃ¹ng `@JsonIgnore` á»Ÿ phÃ­a `@ManyToOne`.

ğŸ”— 1. One-to-One (Quan há»‡ Ä‘á»™c láº­p)
âœ… KhÃ¡i niá»‡m:
One-to-One lÃ  quan há»‡ giá»¯a 2 báº£ng mÃ  má»—i báº£n ghi cá»§a báº£ng A chá»‰ liÃªn káº¿t vá»›i 1 báº£n ghi cá»§a báº£ng B vÃ  ngÆ°á»£c láº¡i.

VÃ­ dá»¥: Má»™t User chá»‰ cÃ³ má»™t Profile riÃªng biá»‡t vÃ  má»—i Profile chá»‰ thuá»™c vá» má»™t User.

ğŸ“˜ VÃ­ dá»¥: User â€“ Profile
ğŸ”¹ User.java
@Entity
@Table(name = "users")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String username;

    @OneToOne(cascade = CascadeType.ALL)
    @JoinColumn(name = "profile_id", referencedColumnName = "id")
    private Profile profile;

    // getters, setters
}
ğŸ”¹ Profile.java
@Entity
@Table(name = "profiles")
public class Profile {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String fullName;
    private String address;

    @OneToOne(mappedBy = "profile")
    private User user;

    // getters, setters
}
ğŸ“Œ Giáº£i thÃ­ch:
@OneToOne: xÃ¡c Ä‘á»‹nh quan há»‡ má»™t-má»™t

@JoinColumn: bÃªn giá»¯ khÃ³a ngoáº¡i (á»Ÿ Ä‘Ã¢y lÃ  User)

mappedBy = "profile": chá»‰ Ä‘á»‹nh quan há»‡ á»Ÿ phÃ­a ngÆ°á»£c láº¡i

ğŸ’¡ CÃ¡c chiáº¿n lÆ°á»£c quan há»‡ trong One-to-One
Chiáº¿n lÆ°á»£c	MÃ´ táº£
@JoinColumn	Báº£ng A giá»¯ khÃ³a ngoáº¡i trá» Ä‘áº¿n báº£ng B
@PrimaryKeyJoinColumn	Hai báº£ng dÃ¹ng chung cÃ¹ng má»™t khÃ³a chÃ­nh (hiáº¿m dÃ¹ng)
mappedBy	DÃ¹ng á»Ÿ phÃ­a khÃ´ng sá»Ÿ há»¯u quan há»‡

ğŸ“Š 2. FetchType.LAZY vs EAGER
âœ… KhÃ¡i niá»‡m:
Hibernate há»— trá»£ 2 cháº¿ Ä‘á»™ load dá»¯ liá»‡u liÃªn quan (fetching):
FetchType	MÃ´ táº£
LAZY	Chá»‰ truy váº¥n dá»¯ liá»‡u khi cáº§n dÃ¹ng (trÃ¬ hoÃ£n)
EAGER	Tá»± Ä‘á»™ng load ngay láº­p tá»©c cÃ¹ng Ä‘á»‘i tÆ°á»£ng cha

ğŸ” VÃ­ dá»¥:
@OneToMany(mappedBy = "user", fetch = FetchType.LAZY)
private List<Post> posts;
â†’ Khi gá»i userRepository.findById(id), dá»¯ liá»‡u trong posts chÆ°a Ä‘Æ°á»£c load ngay, chá»‰ khi gá»i user.getPosts() thÃ¬ Hibernate má»›i truy váº¥n.

NgÆ°á»£c láº¡i:


@OneToMany(mappedBy = "user", fetch = FetchType.EAGER)
â†’ Dá»¯ liá»‡u posts sáº½ load ngay láº­p tá»©c khi User Ä‘Æ°á»£c truy váº¥n.

âš ï¸ LÆ°u Ã½ khi dÃ¹ng
TrÆ°á»ng há»£p	NÃªn dÃ¹ng
Dá»¯ liá»‡u liÃªn quan Ã­t vÃ  cáº§n dÃ¹ng ngay	EAGER
Dá»¯ liá»‡u lá»›n, quan há»‡ phá»©c táº¡p (OneToMany)	LAZY (tá»‘t hÆ¡n cho hiá»‡u suáº¥t)

ğŸ’¥ Lá»—i phá»• biáº¿n:
Khi dÃ¹ng LAZY, náº¿u báº¡n Ä‘Ã³ng Session quÃ¡ sá»›m, gá»i getXXX() sáº½ gÃ¢y lá»—i:
org.hibernate.LazyInitializationException
â†’ Cáº§n xá»­ lÃ½ qua:
@Transactional
DÃ¹ng fetch join trong JPQL/HQL
DÆ°á»›i Ä‘Ã¢y lÃ  **toÃ n bá»™ kiáº¿n thá»©c cÆ¡ báº£n vÃ  quan trá»ng nháº¥t vá» Spring Boot** â€“ pháº§n thÆ°á»ng **ra thi lÃ½ thuyáº¿t, tráº¯c nghiá»‡m** hoáº·c cáº§n hiá»ƒu ká»¹ khi lÃ m dá»± Ã¡n thá»±c táº¿:

---

## ğŸš€ 1. **Spring Boot lÃ  gÃ¬?**

> Spring Boot lÃ  má»™t **framework** dá»±a trÃªn Spring, giÃºp láº­p trÃ¬nh viÃªn xÃ¢y dá»±ng á»©ng dá»¥ng web vÃ  microservices **má»™t cÃ¡ch nhanh chÃ³ng, dá»… dÃ ng vÃ  Ã­t cáº¥u hÃ¬nh**.

---

## ğŸ¯ 2. **Má»¥c tiÃªu cá»§a Spring Boot**

* âœ… Tá»± Ä‘á»™ng cáº¥u hÃ¬nh (Auto-configuration)
* âœ… Giáº£m cáº¥u hÃ¬nh XML rÆ°á»m rÃ 
* âœ… TÃ­ch há»£p dá»… dÃ ng vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u, security, RESTful API, v.v.
* âœ… Cháº¡y á»©ng dá»¥ng dá»… dÃ ng chá»‰ vá»›i `main()` (á»©ng dá»¥ng Ä‘á»™c láº­p - standalone)

---
## ğŸ§© 3. **Cáº¥u trÃºc 3 lá»›p cÆ¡ báº£n trong Spring Boot**

| Táº§ng           | Vai trÃ²                              |
| -------------- | ------------------------------------ |
| **Controller** | Giao tiáº¿p vá»›i client (giao diá»‡n/API) |
| **Service**    | Xá»­ lÃ½ logic nghiá»‡p vá»¥                |
| **Repository** | Truy cáº­p dá»¯ liá»‡u (káº¿t ná»‘i DB)        |
---
## ğŸ“¦ 4. **CÃ¡c annotation thÆ°á»ng gáº·p**
| Annotation                          | Vai trÃ²                          |
| ----------------------------------- | -------------------------------- |
| `@SpringBootApplication`            | ÄÃ¡nh dáº¥u lá»›p chÃ­nh cháº¡y á»©ng dá»¥ng |
| `@RestController`                   | Táº¡o controller RESTful           |
| `@Service`                          | ÄÃ¡nh dáº¥u táº§ng nghiá»‡p vá»¥          |
| `@Repository`                       | Káº¿t ná»‘i cÆ¡ sá»Ÿ dá»¯ liá»‡u            |
| `@Autowired`                        | Tá»± Ä‘á»™ng tiÃªm phá»¥ thuá»™c           |
| `@Entity`                           | Ãnh xáº¡ lá»›p Java thÃ nh báº£ng CSDL  |
| `@Id`                               | Äá»‹nh danh khÃ³a chÃ­nh             |
| `@GeneratedValue`                   | Tá»± Ä‘á»™ng tÄƒng ID                  |
| `@GetMapping`, `@PostMapping`, etc. | Mapping cÃ¡c HTTP method          |
---
## ğŸ§ª 5. **Cáº¥u trÃºc thÆ° má»¥c cÆ¡ báº£n**

```
src/
 â””â”€â”€ main/
      â””â”€â”€ java/
           â””â”€â”€ com.example.demo/
                 â”œâ”€â”€ controller/
                 â”œâ”€â”€ service/
                 â”œâ”€â”€ repository/
                 â”œâ”€â”€ model/
                 â””â”€â”€ DemoApplication.java
```
---
## ğŸ” 6. **CRUD cÆ¡ báº£n vá»›i Spring Boot**

| PhÆ°Æ¡ng thá»©c | Annotation       | Chá»©c nÄƒng   |
| ----------- | ---------------- | ----------- |
| `GET`       | `@GetMapping`    | Láº¥y dá»¯ liá»‡u |
| `POST`      | `@PostMapping`   | Táº¡o má»›i     |
| `PUT`       | `@PutMapping`    | Cáº­p nháº­t    |
| `DELETE`    | `@DeleteMapping` | XÃ³a dá»¯ liá»‡u |

---
## ğŸ§  7. **Spring Boot DevTools**

* Tá»± Ä‘á»™ng **reload láº¡i á»©ng dá»¥ng** khi cÃ³ thay Ä‘á»•i code.
* GiÃºp láº­p trÃ¬nh nhanh hÆ¡n mÃ  khÃ´ng cáº§n stop/start má»—i láº§n.

---

## ğŸ˜ 8. **Spring Boot vá»›i CÆ¡ sá»Ÿ dá»¯ liá»‡u**

* Káº¿t ná»‘i thÃ´ng qua `application.properties` hoáº·c `application.yml`

```properties
spring.datasource.url=jdbc:mysql://localhost:3306/ten_db
spring.datasource.username=root
spring.datasource.password=123456
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
```
## ğŸ“˜ 9. **Spring Boot Starter Dependencies**

Spring Boot cung cáº¥p nhiá»u starter giÃºp thÃªm chá»©c nÄƒng dá»… dÃ ng:

| Starter                        | Chá»©c nÄƒng              |
| ------------------------------ | ---------------------- |
| `spring-boot-starter-web`      | Web, REST API          |
| `spring-boot-starter-data-jpa` | Káº¿t ná»‘i vÃ  thao tÃ¡c DB |
| `spring-boot-starter-security` | Báº£o máº­t                |
| `spring-boot-starter-test`     | Unit test              |

